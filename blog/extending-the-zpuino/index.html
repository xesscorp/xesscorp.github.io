<!doctype html>
<html lang="en">

<head>

<meta http-equiv="Content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width">
<meta name="keywords" content="">
<meta name="description" content="In previous posts, I&#39;ve introduced the ZPUino softcore processorand shown how to build the base instance for an FPGA.But the real advantage of the ZPUino is being able to extend it by attaching new peripheralsto the core processor in the VHDL description.The best way to learn something is by doing it, so in this post I&#39;ll show how to integrate a simple RGB LED driver peripheral into the ZPUino.">
<title>Extending the ZPUino | XESS Corp.</title>
<link rel="shortcut icon" href="../../static/img/xess.ico?v=2">
<link href='http://fonts.googleapis.com/css?family=Open+Sans:400italic,400&subset=latin,latin-ext' rel='stylesheet' type='text/css'>


<link rel="alternate" type="application/rss+xml" title="RSS" href="../feeds/rss/index.html">
<link rel="alternate" type="application/atom+xml" title="Atom" href="../feeds/atom/index.html">


<link rel="stylesheet" href="../../static/CACHE/css/ef03ed7fabaf.css" type="text/css" />

<script type="text/javascript" src="../../static/CACHE/js/1d575eb4744b.js"></script>
<!--[if lt IE 9]>
<script src="/static/js/html5shiv.js"></script>
<![endif]-->



<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-765812-5']);
  _gaq.push(['_setSiteSpeedSampleRate', 50]);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>

</head>
<body id="body">

<div class="navbar navbar-fixed-top">
<div class="navbar-inner">
<div class="container">
    <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
    </a>
    <a href="../../index.html"><img class="logo" src="../../static/img/xess-logo-3.png"></a>
    <!--
    <a class="brand" href="/">XESS Corp.</a>
    
    -->
    <div class="nav-collapse" style="position: relative; top: 5px;">
        
<form action="http://www.xess.com/search/" class="navbar-search pull-right input-append">

<input class="search-query" placeholder="Search" type="text" name="q" value="">
<input type="submit" class="icon-search" value="">



<!-- <input type="submit" class="btn" value="Go!"> -->

</form>

        

<ul class="nav nav-collapse"><li class="" id="dropdown-menu-learn"><a href="../../index.html" class="btn">Home</a></li><!-- <li class="divider-vertical"></li> --><li class="dropdown"
                                id="dropdown-menu-learn"><a href="../../learn/index.html" class="dropdown-toggle active btn">
                                    Learn <span class="caret"></span></a><ul class="dropdown-menu" role="menu"><li
                                    
                                        class="dropdown-submenu"
                                    
                                
                                
                                id="dropdown-menu-tutorials"><a href="../../tutorials/index.html">Tutorials</a></li><li
                                    
                                        class="dropdown-submenu"
                                    
                                
                                 
                                    style="border-top: 1px solid #ddd"
                                
                                id="dropdown-menu-appnotes"><a href="../../appnotes/index.html">Application Notes</a></li><li
                                    
                                        class="dropdown-submenu"
                                    
                                
                                 
                                    style="border-top: 1px solid #ddd"
                                
                                id="dropdown-menu-projects"><a href="../../design_examples.php">Design Examples</a><ul class="dropdown-menu"><li
                                    
                                        class="dropdown-submenu"
                                    
                                
                                
                                id="dropdown-menu--projects-"><a href="../../design_examples.php">XESS</a></li><li
                                    
                                        class="dropdown-submenu"
                                    
                                
                                 
                                    style="border-top: 1px solid #ddd"
                                
                                id="dropdown-menu-projects-others-"><a href="../../projects/others/index.html">Others</a></li></ul></li><li
                                    
                                        class="dropdown-submenu"
                                    
                                
                                 
                                    style="border-top: 4px solid #ddd"
                                
                                id="dropdown-menu-manuals"><a href="../../manuals/index.html">Product Manuals</a><ul class="dropdown-menu"><li
                                    
                                
                                
                                id="dropdown-menu--manuals-"><a href="../../manuals/index.html">Active</a></li><li
                                    
                                
                                 
                                    style="border-top: 1px solid #ddd"
                                
                                id="dropdown-menu--manuals-old-"><a href="../../manuals/old/index.html">Discontinued</a></li></ul></li><li
                                    
                                        class="dropdown-submenu"
                                    
                                
                                 
                                    style="border-top: 1px solid #ddd"
                                
                                id="dropdown-menu-software"><a href="../../downloads.php">Software Tools</a><ul class="dropdown-menu"><li
                                    
                                        class="dropdown-submenu"
                                    
                                
                                
                                id="dropdown-menu--software-"><a href="../../downloads.php">XESS</a><ul class="dropdown-menu"><li
                                    
                                        class="dropdown-submenu"
                                    
                                
                                 
                                    style="border-top: 1px solid #ddd"
                                
                                id="dropdown-menu--software-xess-old-"><a href="../../software/xess/old/index.html">Old</a></li></ul></li><li
                                    
                                        class="dropdown-submenu"
                                    
                                
                                 
                                    style="border-top: 1px solid #ddd"
                                
                                id="dropdown-menu--software-others-"><a href="../../software/others/index.html">Others</a></li></ul></li></ul></li><!-- <li class="divider-vertical"></li> --><li class="dropdown"
                                id="dropdown-menu-store"><a href="../../store/index.html" class="dropdown-toggle active btn">
                                    Buy <span class="caret"></span></a><ul class="dropdown-menu" role="menu"><li
                                    
                                
                                
                                id="dropdown-menu-store-fpga-boards"><a href="../../store/fpga-boards/index.html">FPGA Boards</a></li><li
                                    
                                
                                 
                                    style="border-top: 1px solid #ddd"
                                
                                id="dropdown-menu-store-add-on-boards"><a href="../../store/add-on-boards/index.html">Add-On Boards</a></li><li
                                    
                                
                                 
                                    style="border-top: 1px solid #ddd"
                                
                                id="dropdown-menu-store-miscellaneous"><a href="../../store/miscellaneous/index.html">Miscellaneous</a></li><li
                                    
                                
                                 
                                    style="border-top: 4px solid #ddd"
                                
                                id="dropdown-menu-store-distributors"><a href="../../distributors.php">Distributors</a></li><li
                                    
                                
                                 
                                    style="border-top: 1px solid #ddd"
                                
                                id="dropdown-menu-store-purchasing-policies"><a href="../../store/purchasing-policies/index.html">Sales Policies</a></li><li
                                    
                                
                                 
                                    style="border-top: 1px solid #ddd"
                                
                                id="dropdown-menu-store-discontinued"><a href="../../store/discontinued/index.html">Discontinued Products</a></li></ul></li><!-- <li class="divider-vertical"></li> --><li class="dropdown"
                                id="dropdown-menu-interact"><a href="../../interact/index.html" class="dropdown-toggle active btn">
                                    Interact <span class="caret"></span></a><ul class="dropdown-menu" role="menu"><li
                                    
                                
                                 
                                    style="border-top: 4px solid #ddd"
                                
                                id="dropdown-menu--blog-category-announcements"><a href="../category/announcements">Announcements</a></li><li
                                    
                                
                                 
                                    style="border-top: 1px solid #ddd"
                                
                                id="dropdown-menu--blog-"><a href="../index.html">Blog</a></li><li
                                    
                                
                                 
                                    style="border-top: 1px solid #ddd"
                                
                                id="dropdown-menu-interact-rss-feeds"><a href="../../interact/rss-feeds/index.html">RSS Feeds</a></li><li
                                    
                                
                                 
                                    style="border-top: 4px solid #ddd"
                                
                                id="dropdown-menu-interact-contact"><a href="../../interact/contact/index.html">Contact</a></li><li
                                    
                                
                                 
                                    style="border-top: 1px solid #ddd"
                                
                                id="dropdown-menu--organizations-xess-"><a href="../../organizations/xess/index.html">About</a></li></ul></li><!-- <li class="divider-vertical"></li> --></ul>
    </div>
</div>
</div>
</div>

<div class="container">





<ul class="breadcrumb">
<li class="active">Extending the ZPUino</li>
</ul>

<h1>
Extending the ZPUino
</h1>

</div>

<div class="container">

<div class="row">

<!--
<div class="span2 left">
    
    <div class="panel tree">

<ul class="nav nav-list navlist-menu-level-0"><li class="
             
             
             "
      id="tree-menu-learn"><a href="/learn/">Learn</a><ul class="nav nav-list navlist-menu-level-1"><li class="
             
             
             "
      id="tree-menu---2"><a href="/-2">***menu-divider***</a></li></ul></li><li class="
             
             
             "
      id="tree-menu-store"><a href="/store/">Buy</a><ul class="nav nav-list navlist-menu-level-1"><li class="
             
              first
             "
      id="tree-menu-store-fpga-boards"><a href="/store/fpga-boards/">FPGA Boards</a></li><li class="
             
             
             "
      id="tree-menu-store-add-on-boards"><a href="/store/add-on-boards/">Add-On Boards</a></li><li class="
             
             
             "
      id="tree-menu-store-miscellaneous"><a href="/store/miscellaneous/">Miscellaneous</a></li><li class="
             
             
             "
      id="tree-menu--"><a href="/">***menu-divider***</a></li><li class="
             
             
             "
      id="tree-menu-store-distributors"><a href="/store/distributors/">Distributors</a></li><li class="
             
             
             "
      id="tree-menu-store-purchasing-policies"><a href="/store/purchasing-policies/">Sales Policies</a></li><li class="
             
             
              last"
      id="tree-menu-store-discontinued"><a href="/store/discontinued/">Discontinued Products</a></li></ul></li><li class="
             
             
              last"
      id="tree-menu-interact"><a href="/interact/">Interact</a><ul class="nav nav-list navlist-menu-level-1"><li class="
             
              first
             "
      id="tree-menu---3"><a href="/-3">***menu-divider***</a></li><li class="
             
             
             "
      id="tree-menu--blog-category-announcements"><a href="/blog/category/announcements">Announcements</a></li><li class="
             
             
             "
      id="tree-menu--blog-"><a href="/blog/">Blog</a></li><li class="
             
             
             "
      id="tree-menu-interact-rss-feeds"><a href="/interact/rss-feeds/">RSS Feeds</a></li><li class="
             
             
             "
      id="tree-menu---1"><a href="/-1">***menu-divider***</a></li><li class="
             
             
             "
      id="tree-menu-interact-contact"><a href="/interact/contact/">Contact</a></li><li class="
             
             
              last"
      id="tree-menu--organizations-xess-"><a href="/organizations/xess/">About</a></li></ul></li></ul>
</div>
    
</div>
-->

<!-- <div class="span7 middle"> -->
<div class="span9 middle">

    <!-- This is a section that shows up on product pages with pictures, features, price, quantity, etc. -->
    <div class="container">
        <div class="row">
            <div class="span4 left">
                
            </div>
            <div class="span5 right">
                <div class="container">
                    <div class="row">
                        <div class="span3 left">
                            
                        </div>
                        <div class="span2">
                            <div class="row">
                                
                            </div>
                            <div class="row">
                                
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="span5 left">
                            
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- This is the main content block. -->
    



<h6>
    Posted by:
    
    <a href="../author/devbisme/index.html">Dave Vandenbout</a>
    
    5 years, 6 months ago
</h6>



<p>
    
        (<a href="index.html#comments">2 comments</a>)
        
    
</p>










<p><img class="thumbnail-it float-it-left" src="../../static/media/uploads/blog/devbisme/2015-01-05/ZPUino_Extend.png">
In previous posts, I've 
<a href="../ive-never-bought-an-arduino-but-now-i-have-1000-of-them/index.html">introduced the ZPUino softcore processor</a>
and shown how to <a href="../building-the-zpuino/index.html">build the base instance for an FPGA</a>.
But the real advantage of the ZPUino is being able to extend it by attaching new peripherals
to the core processor in the VHDL description.
The best way to learn something is by doing it, so in this post I'll show how to integrate a 
simple RGB LED driver peripheral into the ZPUino.</p>
<p>The ZPUino architecture incorporates 16 <em>slots</em> that can be populated with peripherals.
A particular slot is activated when the ZPUino core processor accesses an I/O address within the
range of addresses assigned to that slot.
Then  the peripheral in that slot can pass data back-and-forth with the processor through a 
<a href="http://en.wikipedia.org/wiki/Wishbone_%28computer_bus%29">Wishbone interface</a>
that consists of parallel address and data buses along with control signals and 
a handshake synchronization protocol.</p>
<p>The Wishbone interfaces to peripherals are instantiated in the 
<a href="https://github.com/xesscorp/ZPUino-HDL/blob/RGB_LED_Example/zpu/hdl/zpuino/boards/xula2/xula2/xula2_top.vhd">top-level module of the ZPUino VHDL code</a>.
Within the module are empty slots like this:</p>
<pre><code>--
-- IO SLOT 9
--

slot9: zpuino_empty_device
port map (
  wb_clk_i  =&gt; wb_clk_i,          -- Clock to peripheral.
  wb_rst_i  =&gt; wb_rst_i,          -- Reset to peripheral.
  wb_dat_o  =&gt; slot_read(9),      -- Data from peripheral.
  wb_dat_i  =&gt; slot_write(9),     -- Data to peripheral.
  wb_adr_i  =&gt; slot_address(9),   -- Address to peripheral.
  wb_we_i   =&gt; slot_we(9),        -- Write-enable to peripheral.
  wb_cyc_i  =&gt; slot_cyc(9),       -- Cycle handshake to peripheral.
  wb_stb_i  =&gt; slot_stb(9),       -- Chip-select to peripheral.
  wb_ack_o  =&gt; slot_ack(9),       -- handshake acknowledge from peripheral.
  wb_inta_o =&gt; slot_interrupt(9), -- Interrupt from peripheral.
  id        =&gt; slot_ids(9)        -- Peripheral ID (not part of Wishbone).
);
</code></pre>
<p>All the signals are part of the Wishbone interface except for <code>id</code> which outputs a peripheral-specific code
that the ZPUino processor can use to associate a peripheral performing a specific function
(e.g., a UART) with software drivers for that function.</p>
<p>I constructed the RGB peripheral according to the following block diagram:</p>
<p><img alt="Block diagram for a Wishbone-compliant RGB LED driver peripheral." class="center-it" src="../../static/media/uploads/blog/devbisme/2015-01-05/RGB_Peripheral_Blk_Diag.jpg" style="width: 70%;"></p>
<p>The Wishbone interface allows the processor to read or write a single 32-bit register at address 0.
Each of the lower three bytes of this register controls the duty-cycle of a
pulse-width modulator (PWM).
Varying the duty cycles of the PWMs will change the intensities of the red, green and blue components
which changes the overall color of the RGB LED.
For the excruciating operational details, check out the VHDL for the <a href="https://github.com/xesscorp/VHDL_Lib/blob/master/pwm.vhd">PWM</a>
and the <a href="https://github.com/xesscorp/VHDL_Lib/blob/master/RgbLed.vhd">RGB peripheral</a>.</p>
<p>Next, I instantiated the RGB peripheral in the top-level ZPUino module as follows:</p>
<pre><code>--
-- IO SLOT 9
--

slot9: WbRgbLed
port map (
  wb_clk_i      =&gt; wb_clk_i,
  wb_rst_i      =&gt; wb_rst_i,
  wb_dat_o      =&gt; slot_read(9),
  wb_dat_i      =&gt; slot_write(9),
  wb_adr_i      =&gt; slot_address(9),
  wb_we_i       =&gt; slot_we(9),
  wb_cyc_i      =&gt; slot_cyc(9),
  wb_stb_i      =&gt; slot_stb(9),
  wb_ack_o      =&gt; slot_ack(9),
  wb_inta_o     =&gt; slot_interrupt(9),
  id            =&gt; slot_ids(9),
  redLed_o      =&gt; led_r, -- Output for driving red led.
  grnLed_o      =&gt; led_g, -- Output for driving green led.
  bluLed_o      =&gt; led_b  -- Output for driving blue led.
);
</code></pre>
<p>The <code>led_r</code>, <code>led_g</code>, and <code>led_b</code> output signals have to be attached to pins of the ZPUino
in order to connect to the physical RGB LED. I could have made these pin assignments
statically, but the ZPUino provides a much more flexible solution with its
<em>Peripheral Pin Select</em> (PPS) mechanism. The PPS is basically a collection of 
multiplexers that allow any one of <em>N</em> outputs to be attached to any one of <em>M</em> 
pins under software control. (There is an equivalent PPS block for redirecting the inputs.)
So with the PPS, I can assign the ZPUino pins that output the RGB PWM signals at run-time.</p>
<p><img alt="PPS output block diagram." class="center-it" src="../../static/media/uploads/blog/devbisme/2015-01-05/PPS_Blk_Diag.jpg" style="width: 70%;"></p>
<p>Within the top-level ZPUino VHDL module, I attached the RGB peripheral outputs to
the output PPS as follows:</p>
<pre><code>process(gpio_spp_read, spi_pf_mosi, spi_pf_sck,
        sigmadelta_spp_data,timers_pwm,
        spi2_mosi, spi2_sck, led_r, led_g, led_b )
begin

  gpio_spp_data &lt;= (others =&gt; DontCareValue);

  -- PPS Outputs
  gpio_spp_data(0)  &lt;= sigmadelta_spp_data(0);   -- PPS0 : SIGMADELTA DATA
  ppsout_info_slot(0) &lt;= 5; -- Slot 5
  ppsout_info_pin(0) &lt;= 0;  -- PPS OUT pin 0 (Channel 0)
  .
  .
  .
  gpio_spp_data(6)  &lt;= uart2_tx;   -- PPS6 : UART2 TX
  ppsout_info_slot(6) &lt;= 8; -- Slot 8
  ppsout_info_pin(6) &lt;= 0;  -- PPS OUT pin 0 (Channel 1)

  -- Attach the RGB LED driver outputs to the PPS outputs. 
  gpio_spp_data(7)  &lt;= led_r;   -- PPS7 : Red LED driver
  gpio_spp_data(8)  &lt;= led_g;   -- PPS8 : Green LED driver
  gpio_spp_data(9)  &lt;= led_b;   -- PPS9 : Blue LED driver

  -- PPS inputs
  spi2_miso         &lt;= gpio_spp_read(0);         -- PPS0 : USPI MISO
  ppsin_info_slot(0) &lt;= 6;                    -- USPI is in slot 6
  ppsin_info_pin(0) &lt;= 0;                     -- PPS pin of USPI is 0

  uart2_rx          &lt;= gpio_spp_read(1);         -- PPS1 : UART2 RX
  ppsin_info_slot(1) &lt;= 8;                    -- USPI is in slot 6
  ppsin_info_pin(1) &lt;= 0;                     -- PPS pin of USPI is 0

end process;
</code></pre>
<p>In order to make room in the PPS for the new outputs, I bumped-up the <code>PPSCOUNT_OUT</code> constant in the 
<a href="https://github.com/xesscorp/ZPUino-HDL/blob/RGB_LED_Example/zpu/hdl/zpuino/boards/xula2/xula2/zpuino_config.vhd"><code>zpuino_config.vhd</code></a>
file:</p>
<pre><code>-- Set this to the max. number of output pps on the system
constant PPSCOUNT_OUT: integer := 10; -- Increased to handle RGB LED drivers.
</code></pre>
<p>After making these changes, I rebuilt the ZPUino FPGA bitstream with the newly-added RGB peripheral.
Now it's just a matter of writing the software for accessing the new peripheral.
I'll demonstrate this by writing an 
<a href="https://github.com/xesscorp/ZPUino-HDL/blob/RGB_LED_Example/zpu/hdl/zpuino/boards/xula2/xula2/RGB_color_ramp/RGB_color_ramp.ino">example program</a>
that ramps-up and then fades an RGB LED over a sequence of colors.</p>
<p>The program starts (as most do) with a set of definitions.
This is where I tell the program about the decisions I made in the VHDL code:
the location of the RGB peripheral (slot 9), the address offset of the color register (0),
and the position of the red, green and blue outputs going into the PPS block (7, 8, and 9).
I also specify the ZPUino pins that the RGB LED will be connected to (5, 4 and 3).</p>
<pre><code>// Slot the RGB peripheral is assigned to.
#define RGB_SLOT 9
// Address of the color register in the RGB peripheral.
#define COLOR_REG 0
// Position of the red, green and blue PWM outputs
// within the PPS output block.
#define RED_PPS_POS 7
#define GRN_PPS_POS 8
#define BLU_PPS_POS 9
// ZPUino pins for driving an RGB LED.
#define RED_PIN 5
#define GRN_PIN 4
#define BLU_PIN 3
</code></pre>
<p>Next, I use these definitions in the <code>setup()</code> routine.
The ZPUino pins driving the RGB LED are enabled as outputs,
and these outputs are driven by the multiplexers from the PPS.
Then each multiplexer is programmed to output one of the PWM signals
from the RGB peripheral.</p>
<pre><code>void setup() {
  // Enable the outputs to the RGB LED.
  pinMode(RED_PIN, OUTPUT);
  pinMode(GRN_PIN, OUTPUT);
  pinMode(BLU_PIN, OUTPUT);
  // Enable the peripheral pin multiplexer for the outputs.
  pinModePPS(RED_PIN, HIGH);
  pinModePPS(GRN_PIN, HIGH);
  pinModePPS(BLU_PIN, HIGH);
  // Map the PWM outputs to the RGB output pins.
  outputPinForFunction(RED_PIN, RED_PPS_POS);
  outputPinForFunction(GRN_PIN, GRN_PPS_POS);
  outputPinForFunction(BLU_PIN, BLU_PPS_POS);
}
</code></pre>
<p>Then there's the little <code>set_rgb_color()</code> subroutine that accepts a 24-bit color value
and writes it to the color register within the RGB peripheral.
The <code>IO_SLOT(RGB_SLOT)</code> macro-call generates the base address for the RGB peripheral.
Then the <code>REGISTER(...)</code> macro-call adds the offset of the color register 
to the base address to generate the final address where the new color value is written.</p>
<pre><code>void set_rgb_color(unsigned int color)
{
  REGISTER(IO_SLOT(RGB_SLOT), COLOR_REG) = color;
}
</code></pre>
<p>The meat of the example program is contained in the <code>brighten_then_fade()</code> subroutine that ramps the RGB LED
up to its maximum color intensity and then down to zero.
It accepts a <code>color_increment</code> argument that contains either a 0 or a 1
in each of its eight-bit fields.
For example, the value <code>0x000101</code> would change both the red and green 
fields while leaving the blue component alone.
Starting from zero, this argument is added to the RGB color until it reaches
its maximum intensity (<code>0x00FFFF</code>  for the example value of the <code>color_increment</code>).
Then the argument is subtracted from the color until it again reaches zero.</p>
<pre><code>void brighten_then_fade(unsigned int color_increment)
{
  // Start at black and ramp up color intensity.
  unsigned int color = 0;
  for(int i=0; i&lt;256; i++)
  {
    set_rgb_color(color);
    color += color_increment;
    delay(3);
  }
  // Stay at maximum intensity for a while.
  delay(200);
  // Ramp back down to black.
  for(int i=0; i&lt;255; i++)
  {
    color -= color_increment;
    set_rgb_color(color);
    delay(3);
  }
}
</code></pre>
<p>Finally, there's the never-ending <code>loop()</code> routine that applies the previous subroutine
to a sequence of colors:</p>
<pre><code>void loop() {
  // Color sequence: red, green, blue, yellow, magenta, cyan and white. 
  unsigned int color_increment[] = {0x000001, 0x000100, 0x010000, 0x000101, 0x010001, 0x010100, 0x010101};
  // Brighten and then fade each color in the sequence.
  for(int i=0; i&lt;sizeof(color_increment)/sizeof(unsigned int); i++)
    brighten_then_fade(color_increment[i]);
}
</code></pre>
<p>When I run the program on the extended ZPUino, I get the expected output on the LED as shown here:</p>
<iframe class="center-it" height="315" src="http://www.youtube.com/embed/VixKPF7m-RI" width="420"></iframe>

<p>So to recap, I added a new peripheral to the ZPUino by:</p>
<ul>
<li>Describing the peripheral using VHDL.</li>
<li>Putting a Wishbone interface on it.</li>
<li>Instantiating the peripheral in one of the empty slots in the top-level ZPUino module.</li>
<li>Adding input and output signals of the peripheral to the PPS blocks.</li>
<li>Writing ZPUino code using the <code>IO_SLOT</code> and <code>REGISTER</code> macros to access the peripheral.</li>
</ul>
<p>That's it!</p>










<div class="panel rating">

<p id="rating-72">
    
    Current rating: 5
    
</p>


<form method="post" action="http://www.xess.com/rating/">
    
    <input type='hidden' name='csrfmiddlewaretoken' value='6b1VE9U0elkvk2ULdzSg74n8Zb3IQATQ' />
    
    <ul><li> <ul>
<li><label for="id_value_0"><input id="id_value_0" name="value" type="radio" value="1" /> 1</label></li>
<li><label for="id_value_1"><input id="id_value_1" name="value" type="radio" value="2" /> 2</label></li>
<li><label for="id_value_2"><input id="id_value_2" name="value" type="radio" value="3" /> 3</label></li>
<li><label for="id_value_3"><input id="id_value_3" name="value" type="radio" value="4" /> 4</label></li>
<li><label for="id_value_4"><input id="id_value_4" name="value" type="radio" value="5" /> 5</label></li>
</ul><input id="id_content_type" name="content_type" type="hidden" value="blog.blogpost" /><input id="id_object_pk" name="object_pk" type="hidden" value="72" /><input id="id_timestamp" name="timestamp" type="hidden" value="1593966800" /><input id="id_security_hash" name="security_hash" type="hidden" value="c736014923a226404becb7b4572d626db4b07f23" /></li></ul>
    <input type="submit" class="btn" value="Rate"
        onclick="return $(this.form).find('input:checked').length == 1;">
</form>


<br style="clear:both">

</div>




<a class="btn small primary share-twitter" target="_blank" href="http://twitter.com/home?status=http%3A//www.xess.com/blog/extending-the-zpuino/%20Extending%20the%20ZPUino">Share on Twitter</a>
<a class="btn small primary share-facebook" target="_blank" href="http://facebook.com/sharer.php?u=http://www.xess.com/blog/extending-the-zpuino/&amp;t=Extending%20the%20ZPUino">Share on Facebook</a>
<a class="btn small primary share-reddit" target="_blank" href="http://www.reddit.com/submit" onclick="window.location = 'http://www.reddit.com/submit?url=' + encodeURIComponent(window.location); return false">Share on Reddit</a>



<ul class="pager">


<li class="previous">
    <a href="../esp8266-reflash/index.html">&larr; ESP8266: Reflash Dance!</a>
</li>




<li class="next">
    <a href="../terminal-velocity/index.html">Terminal Velocity! &rarr;</a>
</li>


</ul>








<div id="comments">
<h3>Comments</h3>

<script>
$(function() {
    $('.reply').click(function() {
        $('.reply-form').hide();
        $(this).next('.reply-form').toggle();
    });
});
</script>
<style>.input_id_honeypot {display:none !important;}</style>


<ul class="unstyled">
    

    <li id="comment-203"
        >
        
        

        <strong>
            
            <img src="http://www.gravatar.com/avatar/5062fb7e5cefb8cd22663916b5db898c?s=32&amp;d=identicon&amp;r=PG">
            Robert Pflaum
            
        </strong>
        <span class="timespan">5 years, 5 months ago</span>
        <p>Dave,<br /><br />I have been following this series on ZPUINO 2.0 . However the source code I have does not appear to be the same as you describe. I do not see the ID output in the instantiation. I used the link you provided earlier in this series to download the source. It appears to be the source for SOURCE 1.0 not 2.0. What have I done wrong?<br /></p>

        <a href="index.html#comment-203">Link</a> /
        <a href="index.html#reply-203" class="reply">Reply</a>
        <form class="reply-form" method="post" id="reply-203"
            action="http://www.xess.com/comment/#reply-203"
            style="display:none;">
            
            




<input type="hidden" name="referrer" value="http://www.xess.com/blog/archive/2015/2/">
<input type='hidden' name='csrfmiddlewaretoken' value='6b1VE9U0elkvk2ULdzSg74n8Zb3IQATQ' />




<input id="id_content_type" name="content_type" type="hidden" value="blog.blogpost" />



<input id="id_object_pk" name="object_pk" type="hidden" value="72" />



<input id="id_timestamp" name="timestamp" type="hidden" value="1593966800" />



<input id="id_security_hash" name="security_hash" type="hidden" value="c736014923a226404becb7b4572d626db4b07f23" />



<div class="control-group input_id_name 
    ">
    <label class="control-label" for="id_name">
        Name
    </label>
    <div class="controls">
        <input id="id_name" maxlength="50" name="name" type="text" />
        
        <span class="help-inline">required</span>
        
    </div>
</div>



<div class="control-group input_id_email 
    ">
    <label class="control-label" for="id_email">
        Email
    </label>
    <div class="controls">
        <input id="id_email" name="email" type="text" />
        
        <span class="help-inline">required (not published)</span>
        
    </div>
</div>



<div class="control-group input_id_url 
    ">
    <label class="control-label" for="id_url">
        Website
    </label>
    <div class="controls">
        <input id="id_url" name="url" type="text" />
        
        <span class="help-inline">optional</span>
        
    </div>
</div>



<div class="control-group input_id_comment 
    ">
    <label class="control-label" for="id_comment">
        Comment
    </label>
    <div class="controls">
        <textarea cols="40" id="id_comment" name="comment" rows="10">
</textarea>
        
        <span class="help-inline"></span>
        
    </div>
</div>



<div class="control-group input_id_honeypot 
    ">
    <label class="control-label" for="id_honeypot">
        If you enter anything in this field your comment will be treated as spam
    </label>
    <div class="controls">
        <input id="id_honeypot" name="honeypot" type="text" />
        
        <span class="help-inline"></span>
        
    </div>
</div>



            
            <input type="hidden" name="replied_to" value="203">
            <input class="btn btn-primary btn-large" type="submit" value="Reply">
        </form>

        
        
        
        

<ul class="unstyled">
    
    
</ul>


    </li>
    

    <li id="comment-204"
        class="comment-author">
        
        

        <strong>
            
            <img src="http://www.gravatar.com/avatar/14b5f0d9e68fbad88c585a366eb00f08?s=32&amp;d=identicon&amp;r=PG">
            Dave Vandenbout
            
        </strong>
        <span class="timespan">5 years, 5 months ago</span>
        <p>Hi, Robert. I got bit by this same problem. Before you download the source, make sure to select the correct branch in the drop-down list in the upper left of the webpage. For the RGB LED example, that would be &quot;RGB_LED_Example&quot;. If you want one of the previous implementations, then the &quot;zpuino2_xula2_usb_uart&quot; would also contain the ZPUino 2.0 code.</p>

        <a href="index.html#comment-204">Link</a> /
        <a href="index.html#reply-204" class="reply">Reply</a>
        <form class="reply-form" method="post" id="reply-204"
            action="http://www.xess.com/comment/#reply-204"
            style="display:none;">
            
            




<input type="hidden" name="referrer" value="http://www.xess.com/blog/archive/2015/2/">
<input type='hidden' name='csrfmiddlewaretoken' value='6b1VE9U0elkvk2ULdzSg74n8Zb3IQATQ' />




<input id="id_content_type" name="content_type" type="hidden" value="blog.blogpost" />



<input id="id_object_pk" name="object_pk" type="hidden" value="72" />



<input id="id_timestamp" name="timestamp" type="hidden" value="1593966800" />



<input id="id_security_hash" name="security_hash" type="hidden" value="c736014923a226404becb7b4572d626db4b07f23" />



<div class="control-group input_id_name 
    ">
    <label class="control-label" for="id_name">
        Name
    </label>
    <div class="controls">
        <input id="id_name" maxlength="50" name="name" type="text" />
        
        <span class="help-inline">required</span>
        
    </div>
</div>



<div class="control-group input_id_email 
    ">
    <label class="control-label" for="id_email">
        Email
    </label>
    <div class="controls">
        <input id="id_email" name="email" type="text" />
        
        <span class="help-inline">required (not published)</span>
        
    </div>
</div>



<div class="control-group input_id_url 
    ">
    <label class="control-label" for="id_url">
        Website
    </label>
    <div class="controls">
        <input id="id_url" name="url" type="text" />
        
        <span class="help-inline">optional</span>
        
    </div>
</div>



<div class="control-group input_id_comment 
    ">
    <label class="control-label" for="id_comment">
        Comment
    </label>
    <div class="controls">
        <textarea cols="40" id="id_comment" name="comment" rows="10">
</textarea>
        
        <span class="help-inline"></span>
        
    </div>
</div>



<div class="control-group input_id_honeypot 
    ">
    <label class="control-label" for="id_honeypot">
        If you enter anything in this field your comment will be treated as spam
    </label>
    <div class="controls">
        <input id="id_honeypot" name="honeypot" type="text" />
        
        <span class="help-inline"></span>
        
    </div>
</div>



            
            <input type="hidden" name="replied_to" value="204">
            <input class="btn btn-primary btn-large" type="submit" value="Reply">
        </form>

        
        
        
        

<ul class="unstyled">
    
    
</ul>


    </li>
    
    
</ul>


<h3>New Comment</h3>
<form method="post" id="comment" action="http://www.xess.com/comment/#comment">
    
    




<input type="hidden" name="referrer" value="http://www.xess.com/blog/archive/2015/2/">
<input type='hidden' name='csrfmiddlewaretoken' value='6b1VE9U0elkvk2ULdzSg74n8Zb3IQATQ' />




<input id="id_content_type" name="content_type" type="hidden" value="blog.blogpost" />



<input id="id_object_pk" name="object_pk" type="hidden" value="72" />



<input id="id_timestamp" name="timestamp" type="hidden" value="1593966800" />



<input id="id_security_hash" name="security_hash" type="hidden" value="c736014923a226404becb7b4572d626db4b07f23" />



<div class="control-group input_id_name 
    ">
    <label class="control-label" for="id_name">
        Name
    </label>
    <div class="controls">
        <input id="id_name" maxlength="50" name="name" type="text" />
        
        <span class="help-inline">required</span>
        
    </div>
</div>



<div class="control-group input_id_email 
    ">
    <label class="control-label" for="id_email">
        Email
    </label>
    <div class="controls">
        <input id="id_email" name="email" type="text" />
        
        <span class="help-inline">required (not published)</span>
        
    </div>
</div>



<div class="control-group input_id_url 
    ">
    <label class="control-label" for="id_url">
        Website
    </label>
    <div class="controls">
        <input id="id_url" name="url" type="text" />
        
        <span class="help-inline">optional</span>
        
    </div>
</div>



<div class="control-group input_id_comment 
    ">
    <label class="control-label" for="id_comment">
        Comment
    </label>
    <div class="controls">
        <textarea cols="40" id="id_comment" name="comment" rows="10">
</textarea>
        
        <span class="help-inline"></span>
        
    </div>
</div>



<div class="control-group input_id_honeypot 
    ">
    <label class="control-label" for="id_honeypot">
        If you enter anything in this field your comment will be treated as spam
    </label>
    <div class="controls">
        <input id="id_honeypot" name="honeypot" type="text" />
        
        <span class="help-inline"></span>
        
    </div>
</div>



    
    <div class="form-actions">
        <input class="btn btn-primary btn-large" type="submit" value="Comment">
    </div>
</form>

</div>




    
</div>

<div class="span3 right">
    
    
<div class="panel">
    <a href="../../shop/cart/index.html">
    0 items
    in cart:
    $0.00</a><br><br><a href="../../accounts/login/index.html?next=%252Fblog%252Fextending-the-zpuino%252F"
        class="btn btn-small btn-account">Log in</a>
    or
    <a href="../../account/signup/index.html?next=%252Fblog%252Fextending-the-zpuino%252F"
        class="btn btn-small btn-account">Sign up</a>
</div>

    
    <div class="panel">
    





<h3>Recent Posts</h3>
<ul class="unstyled recent-posts">

<li><a href="../are-you-in-an-abusive-relationship-with-your-schematic-editor/index.html"
    >Are You In An Abusive Relationship With Your Schematic Editor?</a></li>

<li><a href="../walk-in-walk-out/index.html"
    >Walk In, Walk Out</a></li>

<li><a href="../colossus-al/index.html"
    >Colossus-al!</a></li>

<li><a href="../extinction-level-event/index.html"
    >Extinction Level Event</a></li>

<li><a href="../esp8266-re-reflash-dance/index.html"
    >ESP8266: Re-Reflash Dance!</a></li>

</ul>






<h3>Archive</h3>

    
        
        <h6>2016</h6><ul class="unstyled">
    
    <li><a href="../archive/2016/9/index.html"
        >September</a> (1)</li>

    
    <li><a href="../archive/2016/6/index.html"
        >June</a> (2)</li>

    
    <li><a href="../archive/2016/5/index.html"
        >May</a> (1)</li>

    
    <li><a href="../archive/2016/3/index.html"
        >March</a> (1)</li>

    
    <li><a href="../archive/2016/2/index.html"
        >February</a> (1)</li>

    
        </ul>
        <h6>2015</h6><ul class="unstyled">
    
    <li><a href="../archive/2015/8/index.html"
        >August</a> (1)</li>

    
    <li><a href="../archive/2015/7/index.html"
        >July</a> (1)</li>

    
    <li><a href="../archive/2015/6/index.html"
        >June</a> (1)</li>

    
    <li><a href="../archive/2015/5/index.html"
        >May</a> (2)</li>

    
    <li><a href="../archive/2015/4/index.html"
        >April</a> (1)</li>

    
    <li><a href="../archive/2015/3/index.html"
        >March</a> (1)</li>

    
    <li><a href="../archive/2015/2/index.html"
        >February</a> (3)</li>

    
    <li><a href="../archive/2015/1/index.html"
        >January</a> (2)</li>

    
        </ul>
        <h6>2014</h6><ul class="unstyled">
    
    <li><a href="../archive/2014/12/index.html"
        >December</a> (2)</li>

    
    <li><a href="../archive/2014/11/index.html"
        >November</a> (1)</li>

    
    <li><a href="../archive/2014/10/index.html"
        >October</a> (4)</li>

    
    <li><a href="../archive/2014/7/index.html"
        >July</a> (1)</li>

    
    <li><a href="../archive/2014/6/index.html"
        >June</a> (2)</li>

    
    <li><a href="../archive/2014/5/index.html"
        >May</a> (1)</li>

    
    <li><a href="../archive/2014/4/index.html"
        >April</a> (1)</li>

    
    <li><a href="../archive/2014/3/index.html"
        >March</a> (3)</li>

    
    <li><a href="../archive/2014/2/index.html"
        >February</a> (1)</li>

    
    <li><a href="../archive/2014/1/index.html"
        >January</a> (1)</li>

    
        </ul>
        <h6>2013</h6><ul class="unstyled">
    
    <li><a href="../archive/2013/10/index.html"
        >October</a> (1)</li>

    
    <li><a href="../archive/2013/9/index.html"
        >September</a> (2)</li>

    
    <li><a href="../archive/2013/2/index.html"
        >February</a> (2)</li>

    
    <li><a href="../archive/2013/1/index.html"
        >January</a> (1)</li>

    
        </ul>
        <h6>2012</h6><ul class="unstyled">
    
    <li><a href="../archive/2012/10/index.html"
        >October</a> (2)</li>

    
    <li><a href="../archive/2012/8/index.html"
        >August</a> (2)</li>

    
    <li><a href="../archive/2012/7/index.html"
        >July</a> (3)</li>

    
    <li><a href="../archive/2012/6/index.html"
        >June</a> (1)</li>

    
    <li><a href="../archive/2012/5/index.html"
        >May</a> (1)</li>

    
    <li><a href="../archive/2012/4/index.html"
        >April</a> (2)</li>

    
    <li><a href="../archive/2012/3/index.html"
        >March</a> (1)</li>

    
    <li><a href="../archive/2012/1/index.html"
        >January</a> (1)</li>

    
        </ul>
        <h6>2011</h6><ul class="unstyled">
    
    <li><a href="../archive/2011/12/index.html"
        >December</a> (4)</li>

    
    <li><a href="../archive/2011/11/index.html"
        >November</a> (1)</li>

    
    <li><a href="../archive/2011/10/index.html"
        >October</a> (2)</li>

    
    <li><a href="../archive/2011/9/index.html"
        >September</a> (2)</li>

    
    <li><a href="../archive/2011/8/index.html"
        >August</a> (1)</li>

    
    <li><a href="../archive/2011/7/index.html"
        >July</a> (2)</li>

    
    <li><a href="../archive/2011/6/index.html"
        >June</a> (5)</li>

    
    <li><a href="../archive/2011/5/index.html"
        >May</a> (1)</li>

</ul>






<h3>Categories</h3>
<ul class="unstyled">

<li><a href="../category/announcements"
    >Announcements</a> (3)</li>

<li><a href="../category/blog-post/index.html"
    >Blog Post</a> (69)</li>

</ul>











<h3>Authors</h3>
<ul class="unstyled">

    <li><a href="../author/devbisme/index.html"
        >Dave Vandenbout</a>
        (72)</li>

</ul>




<h3>Feeds</h3>




    <a href="../feeds/rss/index.html">RSS</a> /
    <a href="../feeds/atom/index.html">Atom</a>




    </div>
</div>

</div>
</div>

<footer>
<div class="container">
<!-- 

<ul class="clearfix"><li><ul><li 
            id="footer-menu-learn"><a href="/learn/">Learn</a></li><li 
            id="footer-menu---2"><a href="/-2">***menu-divider***</a></li></ul></li><li><ul><li 
            id="footer-menu-store"><a href="/store/">Buy</a></li><li 
            id="footer-menu-store-fpga-boards"><a href="/store/fpga-boards/">FPGA Boards</a></li><li 
            id="footer-menu-store-add-on-boards"><a href="/store/add-on-boards/">Add-On Boards</a></li><li 
            id="footer-menu-store-miscellaneous"><a href="/store/miscellaneous/">Miscellaneous</a></li><li 
            id="footer-menu--"><a href="/">***menu-divider***</a></li><li 
            id="footer-menu-store-distributors"><a href="/store/distributors/">Distributors</a></li><li 
            id="footer-menu-store-purchasing-policies"><a href="/store/purchasing-policies/">Sales Policies</a></li><li 
            id="footer-menu-store-discontinued"><a href="/store/discontinued/">Discontinued Products</a></li></ul></li><li><ul><li 
            id="footer-menu-interact"><a href="/interact/">Interact</a></li><li 
            id="footer-menu---3"><a href="/-3">***menu-divider***</a></li><li 
            id="footer-menu--blog-category-announcements"><a href="/blog/category/announcements">Announcements</a></li><li 
            id="footer-menu--blog-"><a href="/blog/">Blog</a></li><li 
            id="footer-menu-interact-rss-feeds"><a href="/interact/rss-feeds/">RSS Feeds</a></li><li 
            id="footer-menu---1"><a href="/-1">***menu-divider***</a></li><li 
            id="footer-menu-interact-contact"><a href="/interact/contact/">Contact</a></li><li 
            id="footer-menu--organizations-xess-"><a href="/organizations/xess/">About</a></li></ul></li></ul>
 -->
<p>
    <a href="mailto:webmaster@xess.com">webmaster@xess.com</a>
    <span class="separator">|</span>
    &copy; 2013 by XESS Corp. All rights reserved.
    
</p>
</div>
</footer>








<script>

var _gaq = _gaq || [['_trackPageview']];
_gaq.unshift(['_setAccount', 'UA-765812-5']);
(function(d, t) {
    var g = d.createElement(t),
        s = d.getElementsByTagName(t)[0];
    g.async = true;
    g.src = '//www.google-analytics.com/ga.js';
    s.parentNode.insertBefore(g, s);
})(document, 'script');


// This is for rendering digital waveforms.
(function(){ window.addEventListener("load", WaveDrom.ProcessAll, false); })();

// This is for drop-down menus.
$('ul.nav li.dropdown').hover(function() {
    $(this).closest('.dropdown-menu').stop(true, true).show();
    $(this).addClass('open'); 
} , function() { 
    $(this).closest('.dropdown-menu').stop(true, true).hide(); 
    $(this).removeClass('open'); 
});
</script>


</body>
</html>
