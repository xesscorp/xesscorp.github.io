<!doctype html>
<html lang="en">

<head>

<meta http-equiv="Content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width">
<meta name="keywords" content="">
<meta name="description" content="A few years ago, my sister and I decided to plant a stand of corn in addition to the regular garden on her farm. This entailed tilling a 50&#39; x 15&#39; area, hoeing the dirt up into about twenty mounds, shaping the mounds for holding water, punching four holes in each mound, and, finally, placing a few kernels in each hole. Then we planted beans among the mounds to try and crowd out the weeds.">
<title>&quot;Hard row to hoe. Came up with squat.&quot;  | XESS Corp.</title>
<link rel="shortcut icon" href="../../static/img/xess.ico?v=2">
<link href='http://fonts.googleapis.com/css?family=Open+Sans:400italic,400&subset=latin,latin-ext' rel='stylesheet' type='text/css'>


<link rel="alternate" type="application/rss+xml" title="RSS" href="../feeds/rss/index.html">
<link rel="alternate" type="application/atom+xml" title="Atom" href="../feeds/atom/index.html">


<link rel="stylesheet" href="../../static/CACHE/css/ef03ed7fabaf.css" type="text/css" />

<script type="text/javascript" src="../../static/CACHE/js/1d575eb4744b.js"></script>
<!--[if lt IE 9]>
<script src="/static/js/html5shiv.js"></script>
<![endif]-->



<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-765812-5']);
  _gaq.push(['_setSiteSpeedSampleRate', 50]);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>

</head>
<body id="body">

<div class="navbar navbar-fixed-top">
<div class="navbar-inner">
<div class="container">
    <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
    </a>
    <a href="../../index.html"><img class="logo" src="../../static/img/xess-logo-3.png"></a>
    <!--
    <a class="brand" href="/">XESS Corp.</a>
    
    -->
    <div class="nav-collapse" style="position: relative; top: 5px;">
        
<form action="http://www.xess.com/search/" class="navbar-search pull-right input-append">

<input class="search-query" placeholder="Search" type="text" name="q" value="">
<input type="submit" class="icon-search" value="">



<!-- <input type="submit" class="btn" value="Go!"> -->

</form>

        

<ul class="nav nav-collapse"><li class="" id="dropdown-menu-learn"><a href="../../index.html" class="btn">Home</a></li><!-- <li class="divider-vertical"></li> --><li class="dropdown"
                                id="dropdown-menu-learn"><a href="../../learn/index.html" class="dropdown-toggle active btn">
                                    Learn <span class="caret"></span></a><ul class="dropdown-menu" role="menu"><li
                                    
                                        class="dropdown-submenu"
                                    
                                
                                
                                id="dropdown-menu-tutorials"><a href="../../tutorials/index.html">Tutorials</a></li><li
                                    
                                        class="dropdown-submenu"
                                    
                                
                                 
                                    style="border-top: 1px solid #ddd"
                                
                                id="dropdown-menu-appnotes"><a href="../../appnotes/index.html">Application Notes</a></li><li
                                    
                                        class="dropdown-submenu"
                                    
                                
                                 
                                    style="border-top: 1px solid #ddd"
                                
                                id="dropdown-menu-projects"><a href="../../design_examples.php">Design Examples</a><ul class="dropdown-menu"><li
                                    
                                        class="dropdown-submenu"
                                    
                                
                                
                                id="dropdown-menu--projects-"><a href="../../design_examples.php">XESS</a></li><li
                                    
                                        class="dropdown-submenu"
                                    
                                
                                 
                                    style="border-top: 1px solid #ddd"
                                
                                id="dropdown-menu-projects-others-"><a href="../../projects/others/index.html">Others</a></li></ul></li><li
                                    
                                        class="dropdown-submenu"
                                    
                                
                                 
                                    style="border-top: 4px solid #ddd"
                                
                                id="dropdown-menu-manuals"><a href="../../manuals/index.html">Product Manuals</a><ul class="dropdown-menu"><li
                                    
                                
                                
                                id="dropdown-menu--manuals-"><a href="../../manuals/index.html">Active</a></li><li
                                    
                                
                                 
                                    style="border-top: 1px solid #ddd"
                                
                                id="dropdown-menu--manuals-old-"><a href="../../manuals/old/index.html">Discontinued</a></li></ul></li><li
                                    
                                        class="dropdown-submenu"
                                    
                                
                                 
                                    style="border-top: 1px solid #ddd"
                                
                                id="dropdown-menu-software"><a href="../../downloads.php">Software Tools</a><ul class="dropdown-menu"><li
                                    
                                        class="dropdown-submenu"
                                    
                                
                                
                                id="dropdown-menu--software-"><a href="../../downloads.php">XESS</a><ul class="dropdown-menu"><li
                                    
                                        class="dropdown-submenu"
                                    
                                
                                 
                                    style="border-top: 1px solid #ddd"
                                
                                id="dropdown-menu--software-xess-old-"><a href="../../software/xess/old/index.html">Old</a></li></ul></li><li
                                    
                                        class="dropdown-submenu"
                                    
                                
                                 
                                    style="border-top: 1px solid #ddd"
                                
                                id="dropdown-menu--software-others-"><a href="../../software/others/index.html">Others</a></li></ul></li></ul></li><!-- <li class="divider-vertical"></li> --><li class="dropdown"
                                id="dropdown-menu-store"><a href="../../store/index.html" class="dropdown-toggle active btn">
                                    Buy <span class="caret"></span></a><ul class="dropdown-menu" role="menu"><li
                                    
                                
                                
                                id="dropdown-menu-store-fpga-boards"><a href="../../store/fpga-boards/index.html">FPGA Boards</a></li><li
                                    
                                
                                 
                                    style="border-top: 1px solid #ddd"
                                
                                id="dropdown-menu-store-add-on-boards"><a href="../../store/add-on-boards/index.html">Add-On Boards</a></li><li
                                    
                                
                                 
                                    style="border-top: 1px solid #ddd"
                                
                                id="dropdown-menu-store-miscellaneous"><a href="../../store/miscellaneous/index.html">Miscellaneous</a></li><li
                                    
                                
                                 
                                    style="border-top: 4px solid #ddd"
                                
                                id="dropdown-menu-store-distributors"><a href="../../distributors.php">Distributors</a></li><li
                                    
                                
                                 
                                    style="border-top: 1px solid #ddd"
                                
                                id="dropdown-menu-store-purchasing-policies"><a href="../../store/purchasing-policies/index.html">Sales Policies</a></li><li
                                    
                                
                                 
                                    style="border-top: 1px solid #ddd"
                                
                                id="dropdown-menu-store-discontinued"><a href="../../store/discontinued/index.html">Discontinued Products</a></li></ul></li><!-- <li class="divider-vertical"></li> --><li class="dropdown"
                                id="dropdown-menu-interact"><a href="../../interact/index.html" class="dropdown-toggle active btn">
                                    Interact <span class="caret"></span></a><ul class="dropdown-menu" role="menu"><li
                                    
                                
                                 
                                    style="border-top: 4px solid #ddd"
                                
                                id="dropdown-menu--blog-category-announcements"><a href="../category/announcements">Announcements</a></li><li
                                    
                                
                                 
                                    style="border-top: 1px solid #ddd"
                                
                                id="dropdown-menu--blog-"><a href="../index.html">Blog</a></li><li
                                    
                                
                                 
                                    style="border-top: 1px solid #ddd"
                                
                                id="dropdown-menu-interact-rss-feeds"><a href="../../interact/rss-feeds/index.html">RSS Feeds</a></li><li
                                    
                                
                                 
                                    style="border-top: 4px solid #ddd"
                                
                                id="dropdown-menu-interact-contact"><a href="../../interact/contact/index.html">Contact</a></li><li
                                    
                                
                                 
                                    style="border-top: 1px solid #ddd"
                                
                                id="dropdown-menu--organizations-xess-"><a href="../../organizations/xess/index.html">About</a></li></ul></li><!-- <li class="divider-vertical"></li> --></ul>
    </div>
</div>
</div>
</div>

<div class="container">





<ul class="breadcrumb">
<li class="active">&quot;Hard row to hoe. Came up with squat.&quot; </li>
</ul>

<h1>
&quot;Hard row to hoe. Came up with squat.&quot; 
</h1>

</div>

<div class="container">

<div class="row">

<!--
<div class="span2 left">
    
    <div class="panel tree">

<ul class="nav nav-list navlist-menu-level-0"><li class="
             
             
             "
      id="tree-menu-learn"><a href="/learn/">Learn</a><ul class="nav nav-list navlist-menu-level-1"><li class="
             
             
             "
      id="tree-menu---2"><a href="/-2">***menu-divider***</a></li></ul></li><li class="
             
             
             "
      id="tree-menu-store"><a href="/store/">Buy</a><ul class="nav nav-list navlist-menu-level-1"><li class="
             
              first
             "
      id="tree-menu-store-fpga-boards"><a href="/store/fpga-boards/">FPGA Boards</a></li><li class="
             
             
             "
      id="tree-menu-store-add-on-boards"><a href="/store/add-on-boards/">Add-On Boards</a></li><li class="
             
             
             "
      id="tree-menu-store-miscellaneous"><a href="/store/miscellaneous/">Miscellaneous</a></li><li class="
             
             
             "
      id="tree-menu--"><a href="/">***menu-divider***</a></li><li class="
             
             
             "
      id="tree-menu-store-distributors"><a href="/store/distributors/">Distributors</a></li><li class="
             
             
             "
      id="tree-menu-store-purchasing-policies"><a href="/store/purchasing-policies/">Sales Policies</a></li><li class="
             
             
              last"
      id="tree-menu-store-discontinued"><a href="/store/discontinued/">Discontinued Products</a></li></ul></li><li class="
             
             
              last"
      id="tree-menu-interact"><a href="/interact/">Interact</a><ul class="nav nav-list navlist-menu-level-1"><li class="
             
              first
             "
      id="tree-menu---3"><a href="/-3">***menu-divider***</a></li><li class="
             
             
             "
      id="tree-menu--blog-category-announcements"><a href="/blog/category/announcements">Announcements</a></li><li class="
             
             
             "
      id="tree-menu--blog-"><a href="/blog/">Blog</a></li><li class="
             
             
             "
      id="tree-menu-interact-rss-feeds"><a href="/interact/rss-feeds/">RSS Feeds</a></li><li class="
             
             
             "
      id="tree-menu---1"><a href="/-1">***menu-divider***</a></li><li class="
             
             
             "
      id="tree-menu-interact-contact"><a href="/interact/contact/">Contact</a></li><li class="
             
             
              last"
      id="tree-menu--organizations-xess-"><a href="/organizations/xess/">About</a></li></ul></li></ul>
</div>
    
</div>
-->

<!-- <div class="span7 middle"> -->
<div class="span9 middle">

    <!-- This is a section that shows up on product pages with pictures, features, price, quantity, etc. -->
    <div class="container">
        <div class="row">
            <div class="span4 left">
                
            </div>
            <div class="span5 right">
                <div class="container">
                    <div class="row">
                        <div class="span3 left">
                            
                        </div>
                        <div class="span2">
                            <div class="row">
                                
                            </div>
                            <div class="row">
                                
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="span5 left">
                            
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- This is the main content block. -->
    



<h6>
    Posted by:
    
    <a href="../author/devbisme/index.html">Dave Vandenbout</a>
    
    8 years, 12 months ago
</h6>



<p>
    
        (<a href="index.html#comments">0 comments</a>)
        
    
</p>










<div class="field-item even"><p>A few years ago, my sister and I decided to plant a stand of corn in addition to the regular garden on her farm. This entailed tilling a 50' x 15' area, hoeing the dirt up into about twenty mounds, shaping the mounds for holding water, punching four holes in each mound, and, finally, placing a few kernels in each hole. Then we planted beans among the mounds to try and crowd out the weeds.<!--more--></p>
<p>That was a lot of work, but we were bolstered in our effort by the belief that this corn would taste much better than the stuff from Food Lion. Through the spring and early summer, my sister watered it and tried to keep keep it under control. But she could only work a couple of hours a day and weeds work 24, so eventually they got the upper hand. In the end, most of the corn stalks didn't even come up to my shoulder, and any ears that appeared were stunted dwarves.</p>
<p>Then, one day, my sister called and was very excited. The conversation went like this:</p>
<blockquote>
<p>"Dave, I found a good ear of corn in the garden!"</p>
<p>"Great! We can have it on Sunday."</p>
<p>"Nope. I stood in the field and ate it."</p>
</blockquote>
<p>That's the way it goes sometimes: you work like hell and end up with squat. And I wonder how often that happens? It seems like every day we're inundated with stories of unparalleled success ("Supercomputer built from an old Philips AM radio, a salt shaker and a carefully folded water bill from 1983!"), but how many projects lie like crashed junkers alongside the road for each technological Cadillac that effortlessly takes the checkered flag?  And I'm not talking about the ideas we all have, think about for a few days, and then abandon when the next one comes along. I'm talking about the ideas we really work on, put money into, devote weeks to, but can't quite push over the finish line. I'm sure there must be a lot, but we hide them away and don't talk about them, like they were children who scored less than 1000 on the SAT.</p>
<p>Well, for everyone who has had a failure like that, let me tell you about one of mine...</p>
<h2>TCM8240</h2>
<p>It all started innocently enough on April 13th when Jayson Tautic of TAUTIC.COM sent a tweet about his upcoming TCM8240 breakout board. The TCM8240 is a Toshiba camera module with a 1.3 Mpixel CMOS sensor. I asked Jayson how he was going to test it. Jayson sells a lot of breadboard power supplies and PIC microcontroller breakouts that can be tested with multimeters, scopes and such, but the TCM8240 is a different beast because it likes to pump out pixels at megahertz rates. That's difficult to capture using a microcontroller.</p>
<p>I had some experience capturing images from NTSC sources using FPGAs and the <a href="http://www.tridentmicro.com/producttree/tv/pc-tv/saa/saa7114/">Philips SAA7114</a>. I took a quick look at the <a href="http://www.sparkfun.com/datasheets/Sensors/Imaging/TCM8240MD_E150405_REV13.pdf">TCM8240 datasheet</a>, said "That looks easy enough!" and contacted Jayson with an offer to assist with testing his board. (The phrase "That looks easy enough!" is right below "Hey! Watch this!" in the list of things said right before something goes seriously wrong.) Jayson agreed to send me one of his boards once he got them and had the TCM8240s mounted. I agreed to connect one to a <a href="../../prods/prod048.php">XuLA FPGA board</a> and see if it could capture images.</p>
<p>On April 22nd, Jayson emailed me about a problem he was having with mounting the TCM8240 on the breakout board: the plastic lens housing was melting when he sent them through the reflow oven! Here's an example of what the lens looked like after reflow:</p>
<img alt="" class="center-it" src="../../static/media/uploads/blog/devbisme/2011-07-11/TCM8240_melted.png" style="width: 400px;">
<p>After discussing it, we decided to proceed with the testing despite the TCM8240's "cataracts". At least I could check the interface between the TCM8240 electronics and the FPGA.</p>
<p>I got two of Jayson's TCM8240 modules on April 26th. I decided to remove the melted lenses so the CMOS sensor could get more light. I promptly destroyed one of the modules by ripping off both the lens and the underlying ultraviolet filter. I was a bit more careful on the remaining unit and managed to get just the lens off. Here's what they looked like afterwards. The module on the left has both the lens and UV filter removed; you can see the bare CMOS sensor. The module on the right has just the lens removed; the UV filter still covers the sensor.</p>
<img alt="" class="center-it" src="../../static/media/uploads/blog/devbisme/2011-07-11/TCM8240_no_lens.png" style="width: 500px;">
<p>To test the TCM8240, I used the same architecture (and most of the VHDL) as I had in my previous SAA7114 project. The TCM8240 dumps pixels into a FIFO inside the FPGA. The FIFO feeds into the external SDRAM on the XuLA board where the pixels are stored. At the same time, pixels are being read from the SDRAM and placed in another FIFO that feeds a VGA interface connected to a monitor. This lets me see the image captured by the TCM8240 in real-time. (The external SDRAM is <em>not </em>a two-port device. There is a dual-port module I built into the FPGA that time-slices access to the SDRAM for the TCM8240 and VGA interfaces. The FIFOs are needed to smooth out interruptions in the data flow when either the TCM8240 or VGA module cannot get immediate access to the SDRAM.)</p>
<img alt="" class="center-it" src="../../static/media/uploads/blog/devbisme/2011-07-11/TCM8240_image_flow.png" style="width: 500px;">
<p>The image datapath wasn't a big concern to me.It had all been worked out years ago for the SAA7114. The TCM8240 has a similar interface to the SAA7114, so the VHDL needed just a moderate number of alterations. What <em>did </em>concern me was the initialization of the TCM8240. In the old design, the SAA7114 was initialized through the parallel port connecting the FPGA board to a PC. There is no parallel port interface on the XuLA Board, so the initialization interface had to be completely re-written. Here's what I did:</p>
<img alt="" class="center-it" src="../../static/media/uploads/blog/devbisme/2011-07-11/TCM8240_init_flow.png" style="width: 500px;">
<p>I use a PC to manage the initialization of the TCM8240. The parameters are sent over a USB link to the XuLA board. The PIC microcontroller on the XuLA accepts the USB packets and sends them to the FPGA's JTAG port. The serial JTAG bits are transformed into a parallel register read/write interface by a custom module I wrote. This module reads and writes registers in an <a href="http://opencores.org/project,i2c">I<sup>2</sup>C module</a> I downloaded from <a href="http://opencores.org/" style="">OpenCores</a>. The TCM8240 has a set of 256 byte-wide configuration registers that are accessed through this I<sup>2</sup>C interface.</p>
<p>Now, there are four separate types of data links in this initialization chain and probably eight-million places for the data to die. I hadn't used the OpenCores I<sup>2</sup>C module before and the few examples given in the manual were rather opaque, so that was a potential trouble spot. And my custom JTAG-to-register module hadn't been tested very much, so more trouble could be waiting there. And the PIC firmware had to be re-worked a bit to manage the USB-to-JTAG translation, so errors could have been made there.</p>
<p>It turned out there were errors in <em>multiple </em>places. I just had to methodically work through the links, fixing errors as I went. I started with the USB-to-JTAG link and executed simple test cases like reading the FPGA device identifier. The PIC would make mistakes if the JTAG packets stretched across multiple USB packets. I fixed that, and then the PIC would fail if the JTAG packet fit <em>inside </em>a single USB packet. And so on and so on... I kept fixing microcontroller code until this part of the link seemed to be working.</p>
<p>Luckily, the JTAG-to-register module worked pretty much right away, so I could move on to using the OpenCores I<sup>2</sup>C module to write and then read registers in the TCM8240. That didn't work at all: it always read all zeroes or ones. So I slowed the I<sup>2</sup>C clock way down, fed static data patterns through it and looked at the clock and data lines on a scope. Then I read the examples from the I<sup>2</sup>C core manual, compared them to other I<sup>2</sup>C tutorials, and pondered when the I<sup>2</sup>C status from the core should be queried. Finally it seemed all the waveforms were correct, but the TCM8240 wasn't responding to them. It was continually NACK'ing every I<sup>2</sup>C transaction.</p>
<p>I turned my attention to the TCM8240. I started by assuming that I<sup>2</sup>C writes were working and it was getting the register data, but that I2C reads were blocked somehow. But I ruled that out when I was unable to make the TCM8240 do anything by initializing its registers. I couldn't enable the data outputs, change the clock frequency using its internal PLL, etc. While doing these tests, I also noticed that the I<sup>2</sup>C lines had activity on them even when the FPGA wasn't writing to the TCM8240. The TCM8240 is a slave device and shouldn't initiate I<sup>2</sup>C bus transactions on its own. So something was screwy with the chip.</p>
<p>I checked the voltage levels for the TCM8240 and they were fine and had no appreciable noise. The clock signal to the chip was clean and at the right frequency. I had the TCM8240 reset input tied low, so I tried pulling it high to give it a clean reset while power was applied. Suddenly, the NACKs on the I<sup>2</sup>C bus disappeared and the FPGA began writing and reading registers on the TCM8240! I had mistakenly assumed that an input labeled "RST" in the datasheet would be active-high and had to be pulled low to release the reset. Instead, it's active-low. This was to be a portent of things to come.</p>
<p>Now that I had the initialization chain working, it was time to load the TCM8240's registers and see if any data popped out. (I wasn't expecting much, what with the melted lens and all.) So I went to find the appropriate register values and, for the first time, really <em>looked </em>at the Toshiba datasheet. Wow, what a piece of shit! There's an address map of the 256 registers with all their mnemonics <em>and that's it!</em> No register descriptions, no list of register values for common usage, <em>nothing</em>. To be fair, some of the mnemonics are easy to figure out, like "LRINV" does a left-to-right inversion of the image. But how about "PBC3LV"? What does <em>that </em>do? Or my all time favorite: "HDCMH_NC".</p>
<p>I did find a <a href="http://www.sparkfun.com/datasheets/Sensors/Imaging/TCM8240MD_APPNOTE041214.pdf">note </a>from Toshiba that lists a few register values for common applications. But here's the thing: some of the register addresses given in the note correspond to unused locations in the register map that the datasheet says "are not able to read and write via I2C bus". In particular, I'm talking about addresses 0x0E, 0x11 and 0x14. These are important registers for setting the size and resolution of the image output by the TCM8240, but the datasheet says they don't even exist.</p>
<p>The next resource I tried was the <a href="http://forum.sparkfun.com/viewtopic.php?f=5&amp;t=10314">Sparkfun forum discussion about the TCM8240</a>. This had twenty-seven pages of messages starting in 2008 between people trying to get the TCM8240 to work. There appeared to be a lot of dissatisfaction. On page <a href="http://forum.sparkfun.com/viewtopic.php?f=5&amp;t=10314&amp;start=180">thirteen</a>, I found a few lists of register values said to give reasonable output. Here's one (I added a "*" before every register that is not listed in the TCM8240 datasheet):</p>
<pre>  Address Data Comments 
 *0x0B   0x00 White Line OFF 
  0x58   0x20 Exposure Time 
  0x05   0x00 Frame Rate Quarter 
  0x1A   0xFF 
  0x1B   0xB3 
 *0x11   0x4A 
 *0x14   0x33 
  0x04   0x0D RGB, 352x288, OUT ON 
  0x1F   0x0B 
  0x1E   0xC3 
 *0x0E   0x1E
</pre>
<p>Of particular note is the register at address 0x0B. This register is not listed in the datasheet or application note. It was found by one of the forum participants by writing sequentially through the addresses until something interesting happened. Even with these values, the captured images he got were over/under exposed and had a purple/pink cast to them.</p>
<p>By May 31st, I could capture the output of the TCM8240 and display it on a VGA monitor (the test setup is shown below), but the result was just a pinkish blob because there was no lense. I could wave my hand over it and see the blob change as the amount of light reaching the sensor varied, but that was about it. I asked Jayson to send me a hand-soldered TCM8240 module with a good lense so I could see what type of images I was getting.</p>
<img alt="" class="center-it" src="../../static/media/uploads/blog/devbisme/2011-07-11/TCM8240_breadboard.jpg" style="width: 400px;">
<p>While waiting for the fully-functional TCM8240 module, I went looking for information on the TCM8230 chip. Some of the participants in the Sparkfun forum had moved to this part and had success after giving up on the TCM8240. I thought the <a href="http://www.datasheets.org.uk/dl/Datasheets-39/DSA-764055.pdf">TCM8230 datasheet</a> might give me some ideas about what some of the TCM8240 registers were for. I mean, they've got nearly the same part numbers, right? There must be some overlap in how they function.</p>
<p>Well, the TCM8230 datasheet didn't shed any light on the TCM8240. The register maps are very different, and there's no explanation of the registers in the TCM8230 datasheet, either. So that was a dead end.</p>
<p>Next, I went looking for other Toshiba camera modules. I found the newer TCM9000 series but all the datasheets were under NDA. No help there since anything I develop is going to be open source. While doing this, I also found mention of the <a href="http://www.letsgodigital.org/en/news/articles/story_3806.html">Standard Mobile Imaging Architecture</a> (SMIA) for camera modules. I thought that might tell me something, but Toshiba didn't commit to it until 2005 and the TCM8240 had been out for a while before that, so this was probably another dead end.</p>
<p>Finally, I called a local Toshiba representative to ask if they had a current TCM8240 datasheet. She said she would check and get back to me. I haven't heard anything, yet. They must have lost my number or had a family emergency or something.</p>
<p>I got a fully functional TCM8240 module from Jayson on June 7th. I must admit I let it sit for a while before installing it. During the interim, I was writing code for the "Register Explorer". Previously, if I wanted to test the effect of changing a register value, I had to do the following:</p>
<ol>
<li>Type the register addresses and values into a text file.</li>
<li>Use a command-line program to download the text file into the XuLA-TCM8240 combo.</li>
<li>Switch the monitor to the output of the XuLA VGA interface. (I used a KVM switch for this.)</li>
<li>Compare the image that appeared on the VGA monitor with my memory of what the display used to look like. (Anything relying on my memory is always dicey.)</li>
</ol><p>Even if this procedure only takes thirty seconds, that makes it impossible to flick a register value back-and-forth and interactively view how the captured image changes. Register Explorer was built to speed-up the changing of registers in the TCM8240. It consists of a DLL for reading and writing registers through the XuLA USB link coupled with a GUI written in Python/wxPython. Here's what the GUI looks like:</p>
<img alt="" class="center-it" src="../../static/media/uploads/blog/devbisme/2011-07-11/TCM8240_explorer.png" style="width: 660px;">
<p>The list at the right of the window has all the known registers of the TCM8240. I can highlight a register and then use the buttons in the middle pane to toggle bits and perform other operations on them. Then I can download to the TCM8240 and see what happens. And I can save and recall the entire set of registers in a file so I can keep interesting configurations.</p>
<p>Using Register Explorer and the new TCM8240 module, I started debugging the imaging path. Jayson recommended that I enable the color bar mode (I didn't even know it had a color bar mode). When I did, the VGA monitor displayed the image shown below in (a). Then I uploaded the image from the SDRAM of the XuLA and wrote a small utility to translate it into the PNG image shown in (b). For comparison, a set of SMPTE color bars is shown in (c). All of these images look like they're in agreement. This showed I could get correctly formatted data from the TCM8240 and that the 2.8V digital levels output by the camera are compatible with the 3.3V I/O levels of the XuLA board. Also, the VGA output matched the image data stored in the SDRAM, so that interface works as well.</p>
<table align="center" border="0" cellpadding="1" cellspacing="5" style="width: 600px;">
<tbody>
<tr>
<td style="vertical-align: middle;"><img alt="" class="center-it" src="../../static/media/uploads/blog/devbisme/2011-07-11/TCM8240_colorbar_vga.jpg" style="height: 150px;"></td>
<td style="vertical-align: middle;"><img alt="" class="center-it" src="../../static/media/uploads/blog/devbisme/2011-07-11/TCM8240_colorbar_ram.png" style="height: 150px;"></td>
<td style="vertical-align: middle;"><img alt="" class="center-it" src="../../static/media/uploads/blog/devbisme/2011-07-11/TCM8240_colorbar_smpte.jpg" style="height: 150px;"></td>
</tr>
<tr>
<td style="vertical-align: middle;">(a)</td>
<td style="vertical-align: middle;">(b)</td>
<td style="vertical-align: middle;">(c)</td>
</tr>
</tbody>
</table>
<p>Next, I disabled the color bars and loaded the registers with the values found on the Sparkfun forum. The result is shown below in (a). The entire image has a bluish cast. I tried every register setting to normalize the picture, even the automatic white-balance. (Of course, I couldn't tell if I enabled the AWB correctly. I can hardly get that feature to work on a modern camera with complete instructions from the manual.)</p>
<p>In desperation, I switched the red and blue components and got the picture shown in (b). This gave the image a reddish cast, but at least the colors were nearer to what they are in reality.</p>
<table align="center" border="0" cellpadding="5" cellspacing="10" style="width: 600px;">
<tbody>
<tr>
<td><img alt="" class="center-it" src="../../static/media/uploads/blog/devbisme/2011-07-11/TCM8240_bookcase_RGB.png" style="width: 352px;"></td>
<td><img alt="" class="center-it" src="../../static/media/uploads/blog/devbisme/2011-07-11/TCM8240_bookcase_BGR.png" style="width: 352px;"></td>
</tr>
<tr>
<td>(a) Image with default RGB order</td>
<td>(b) Image with red &amp; green switched.</td>
</tr>
</tbody>
</table>
<p>Jayson sent me a <a href="http://translate.googleusercontent.com/translate_c?hl=en&amp;prev=/search%3Fq%3Dtcm8240%2Bcell%2Bphone%26start%3D10%26hl%3Den%26client%3Dsafari%26sa%3DN%26rls%3Den%26biw%3D1145%26bih%3D616%26prmd%3Divns&amp;rurl=translate.google.com&amp;sl=ja&amp;twu=1&amp;u=http://fenrir.naruoka.org/archives/000775.html&amp;usg=ALkJrhjl6De4AykoDrdKlSQ5w5EXcalyEg">link </a>from a Japanese website where the writer was using the TCM8240 in a camera that hangs around a cat's neck. Reading some of the code in that post, I saw that they were doing the same thing: reversing the red and blue components of each pixel. Now I like an easy fix as well as the next guy, but the problem with switching red and blue is that the colorbar output will no longer match the SMPTE standard. In that case, what's the use of having the color bar mode at all? Plus, is the datasheet that <em>bad </em>that I can't even trust the bit-ordering of the pixel color? </p>
<p>Aside from the red&lt;-&gt;blue problem, there was also a noise problem in the image path. The color bar images were clean, which means the frame grabbing and VGA display modules in the FPGA were not injecting any noticeable noise. But when the TCM8240 captured real images, there were spots and blemishes. And these spots were at fixed locations in the image field. In image (a), there is a red dot visible in the second bookshelf from the top, near the two white boxes. Panning to the left (b), the bookshelf moves rightward, but the red dot maintains the same position in the image field. There are many additional spots that do the same thing. So there is some problem in the image path. (I checked the TCM8240 power supplies and they were clean, but I doubt the defects resulted from electrical noise because they occurred in the same position on each frame.)</p>
<table align="center" border="0" cellpadding="5" cellspacing="10" style="width: 600px;">
<tbody>
<tr>
<td><img alt="" class="center-it" src="../../static/media/uploads/blog/devbisme/2011-07-11/TCM8240_spots.png" style="width: 352px;"></td>
<td><img alt="" class="center-it" src="../../static/media/uploads/blog/devbisme/2011-07-11/TCM8240_spots_panleft.png" style="width: 352px;"></td>
</tr>
<tr>
<td>(a) Original scene.</td>
<td>(b) Scene captured after panning left.</td>
</tr>
</tbody>
</table>
<p>At this point it was July 9th and I assessed the project as follows:</p>
<ol><li>The breakout board can't be assembled as it stands since the TCM8240 melts during reflow. (Jayson found out that sockets like <a href="http://www.molex.com/molex/products/family?key=camera_sockets&amp;channel=products&amp;chanName=family&amp;pageTitle=Introduction">these </a>are supposed to be used and then the camera module is inserted after reflow.)</li>
<li>The color of the captured images is unbalanced.</li>
<li>There's noise in the images.</li>
<li>I haven't even tried using the JPEG capabilities of the TCM8240, and I really don't want to try given the state of the datasheet.</li>
</ol><p>Looking at where I was and factoring in my estimate of the future revenue if things ever started working, I decided to take this project out back and shoot it in the head. Jayson concurred, so I packed it into a drawer where it can be resurrected if conditions warrant. (What's more likely is that this stuff will eventually migrate to a cardboard box in a closet or get recycled into something else.)</p>
<img alt="" class="center-it" src="../../static/media/uploads/blog/devbisme/2011-07-11/TCM8240_grave.jpg" style="width: 400px;"><p></p>
<p>Now, after every plane crash there's at least one good piece of yard art. So what did I get out of this project? Here's my list:</p>
<ol><li>I got a chance to work with Jayson.</li>
<li>I gained experience with a CMOS camera module.</li>
<li>I learned how to use the OpenCores I<sup>2</sup>C code.</li>
<li>I learned Python and wxPython.</li>
<li>I made my first DLL.</li>
<li>I learned how to build a Python GUI around a DLL.</li>
<li>I built a utility to translate XuLA SDRAM data into standard image formats.</li>
</ol><p>Would I have undertaken this project knowing the effort it would take and what I would get out of it? Well no, of course not. Who would? But projects aren't like books where you can peek at the last page to see how everything turns out. And what fun would that be, anyway? You spin the wheel, drop the ball and you either win big or lose big. It's the unknown that makes it fun.</p>
<p>So this project didn't turn out. That's the way it goes. Maybe you've had one or two projects that did the same. Maybe my story will make you feel better about what happened to you, maybe not. As for me, this project is done and over.</p>
<p>Tomorrow, I'll start another one.</p>
<p> </p>
</div>










<div class="panel rating">

<p id="rating-29">
    
    Current rating: 5
    
</p>


<form method="post" action="http://www.xess.com/rating/">
    
    <input type='hidden' name='csrfmiddlewaretoken' value='6b1VE9U0elkvk2ULdzSg74n8Zb3IQATQ' />
    
    <ul><li> <ul>
<li><label for="id_value_0"><input id="id_value_0" name="value" type="radio" value="1" /> 1</label></li>
<li><label for="id_value_1"><input id="id_value_1" name="value" type="radio" value="2" /> 2</label></li>
<li><label for="id_value_2"><input id="id_value_2" name="value" type="radio" value="3" /> 3</label></li>
<li><label for="id_value_3"><input id="id_value_3" name="value" type="radio" value="4" /> 4</label></li>
<li><label for="id_value_4"><input id="id_value_4" name="value" type="radio" value="5" /> 5</label></li>
</ul><input id="id_content_type" name="content_type" type="hidden" value="blog.blogpost" /><input id="id_object_pk" name="object_pk" type="hidden" value="29" /><input id="id_timestamp" name="timestamp" type="hidden" value="1593966875" /><input id="id_security_hash" name="security_hash" type="hidden" value="8829fc6bf91f29395179af0e4a55e9ce0b9d80b7" /></li></ul>
    <input type="submit" class="btn" value="Rate"
        onclick="return $(this.form).find('input:checked').length == 1;">
</form>


<br style="clear:both">

</div>




<a class="btn small primary share-twitter" target="_blank" href="http://twitter.com/home?status=http%3A//www.xess.com/blog/hard-row-to-hoe-came-up-with-squat/%20%22Hard%20row%20to%20hoe.%20Came%20up%20with%20squat.%22%20">Share on Twitter</a>
<a class="btn small primary share-facebook" target="_blank" href="http://facebook.com/sharer.php?u=http://www.xess.com/blog/hard-row-to-hoe-came-up-with-squat/&amp;t=%22Hard%20row%20to%20hoe.%20Came%20up%20with%20squat.%22%20">Share on Facebook</a>
<a class="btn small primary share-reddit" target="_blank" href="http://www.reddit.com/submit" onclick="window.location = 'http://www.reddit.com/submit?url=' + encodeURIComponent(window.location); return false">Share on Reddit</a>



<ul class="pager">


<li class="previous">
    <a href="../amping-the-xula-clock-up-to-300-mhz/index.html">&larr; Amping the XuLA Clock Up To 300 MHz </a>
</li>




<li class="next">
    <a href="../blinkies-buttons-bah/index.html">Blinkies, Buttons, Bah!!!  &rarr;</a>
</li>


</ul>








<div id="comments">
<h3>Comments</h3>

<script>
$(function() {
    $('.reply').click(function() {
        $('.reply-form').hide();
        $(this).next('.reply-form').toggle();
    });
});
</script>
<style>.input_id_honeypot {display:none !important;}</style>


<ul class="unstyled">
    
    
    <li>There are currently no comments</li>
    
</ul>


<h3>New Comment</h3>
<form method="post" id="comment" action="http://www.xess.com/comment/#comment">
    
    




<input type="hidden" name="referrer" value="http://www.xess.com/blog/archive/2011/7/">
<input type='hidden' name='csrfmiddlewaretoken' value='6b1VE9U0elkvk2ULdzSg74n8Zb3IQATQ' />




<input id="id_content_type" name="content_type" type="hidden" value="blog.blogpost" />



<input id="id_object_pk" name="object_pk" type="hidden" value="29" />



<input id="id_timestamp" name="timestamp" type="hidden" value="1593966875" />



<input id="id_security_hash" name="security_hash" type="hidden" value="8829fc6bf91f29395179af0e4a55e9ce0b9d80b7" />



<div class="control-group input_id_name 
    ">
    <label class="control-label" for="id_name">
        Name
    </label>
    <div class="controls">
        <input id="id_name" maxlength="50" name="name" type="text" />
        
        <span class="help-inline">required</span>
        
    </div>
</div>



<div class="control-group input_id_email 
    ">
    <label class="control-label" for="id_email">
        Email
    </label>
    <div class="controls">
        <input id="id_email" name="email" type="text" />
        
        <span class="help-inline">required (not published)</span>
        
    </div>
</div>



<div class="control-group input_id_url 
    ">
    <label class="control-label" for="id_url">
        Website
    </label>
    <div class="controls">
        <input id="id_url" name="url" type="text" />
        
        <span class="help-inline">optional</span>
        
    </div>
</div>



<div class="control-group input_id_comment 
    ">
    <label class="control-label" for="id_comment">
        Comment
    </label>
    <div class="controls">
        <textarea cols="40" id="id_comment" name="comment" rows="10">
</textarea>
        
        <span class="help-inline"></span>
        
    </div>
</div>



<div class="control-group input_id_honeypot 
    ">
    <label class="control-label" for="id_honeypot">
        If you enter anything in this field your comment will be treated as spam
    </label>
    <div class="controls">
        <input id="id_honeypot" name="honeypot" type="text" />
        
        <span class="help-inline"></span>
        
    </div>
</div>



    
    <div class="form-actions">
        <input class="btn btn-primary btn-large" type="submit" value="Comment">
    </div>
</form>

</div>




    
</div>

<div class="span3 right">
    
    
<div class="panel">
    <a href="../../shop/cart/index.html">
    0 items
    in cart:
    $0.00</a><br><br><a href="../../accounts/login/index.html?next=%252Fblog%252Fhard-row-to-hoe-came-up-with-squat%252F"
        class="btn btn-small btn-account">Log in</a>
    or
    <a href="../../account/signup/index.html?next=%252Fblog%252Fhard-row-to-hoe-came-up-with-squat%252F"
        class="btn btn-small btn-account">Sign up</a>
</div>

    
    <div class="panel">
    





<h3>Recent Posts</h3>
<ul class="unstyled recent-posts">

<li><a href="../are-you-in-an-abusive-relationship-with-your-schematic-editor/index.html"
    >Are You In An Abusive Relationship With Your Schematic Editor?</a></li>

<li><a href="../walk-in-walk-out/index.html"
    >Walk In, Walk Out</a></li>

<li><a href="../colossus-al/index.html"
    >Colossus-al!</a></li>

<li><a href="../extinction-level-event/index.html"
    >Extinction Level Event</a></li>

<li><a href="../esp8266-re-reflash-dance/index.html"
    >ESP8266: Re-Reflash Dance!</a></li>

</ul>






<h3>Archive</h3>

    
        
        <h6>2016</h6><ul class="unstyled">
    
    <li><a href="../archive/2016/9/index.html"
        >September</a> (1)</li>

    
    <li><a href="../archive/2016/6/index.html"
        >June</a> (2)</li>

    
    <li><a href="../archive/2016/5/index.html"
        >May</a> (1)</li>

    
    <li><a href="../archive/2016/3/index.html"
        >March</a> (1)</li>

    
    <li><a href="../archive/2016/2/index.html"
        >February</a> (1)</li>

    
        </ul>
        <h6>2015</h6><ul class="unstyled">
    
    <li><a href="../archive/2015/8/index.html"
        >August</a> (1)</li>

    
    <li><a href="../archive/2015/7/index.html"
        >July</a> (1)</li>

    
    <li><a href="../archive/2015/6/index.html"
        >June</a> (1)</li>

    
    <li><a href="../archive/2015/5/index.html"
        >May</a> (2)</li>

    
    <li><a href="../archive/2015/4/index.html"
        >April</a> (1)</li>

    
    <li><a href="../archive/2015/3/index.html"
        >March</a> (1)</li>

    
    <li><a href="../archive/2015/2/index.html"
        >February</a> (3)</li>

    
    <li><a href="../archive/2015/1/index.html"
        >January</a> (2)</li>

    
        </ul>
        <h6>2014</h6><ul class="unstyled">
    
    <li><a href="../archive/2014/12/index.html"
        >December</a> (2)</li>

    
    <li><a href="../archive/2014/11/index.html"
        >November</a> (1)</li>

    
    <li><a href="../archive/2014/10/index.html"
        >October</a> (4)</li>

    
    <li><a href="../archive/2014/7/index.html"
        >July</a> (1)</li>

    
    <li><a href="../archive/2014/6/index.html"
        >June</a> (2)</li>

    
    <li><a href="../archive/2014/5/index.html"
        >May</a> (1)</li>

    
    <li><a href="../archive/2014/4/index.html"
        >April</a> (1)</li>

    
    <li><a href="../archive/2014/3/index.html"
        >March</a> (3)</li>

    
    <li><a href="../archive/2014/2/index.html"
        >February</a> (1)</li>

    
    <li><a href="../archive/2014/1/index.html"
        >January</a> (1)</li>

    
        </ul>
        <h6>2013</h6><ul class="unstyled">
    
    <li><a href="../archive/2013/10/index.html"
        >October</a> (1)</li>

    
    <li><a href="../archive/2013/9/index.html"
        >September</a> (2)</li>

    
    <li><a href="../archive/2013/2/index.html"
        >February</a> (2)</li>

    
    <li><a href="../archive/2013/1/index.html"
        >January</a> (1)</li>

    
        </ul>
        <h6>2012</h6><ul class="unstyled">
    
    <li><a href="../archive/2012/10/index.html"
        >October</a> (2)</li>

    
    <li><a href="../archive/2012/8/index.html"
        >August</a> (2)</li>

    
    <li><a href="../archive/2012/7/index.html"
        >July</a> (3)</li>

    
    <li><a href="../archive/2012/6/index.html"
        >June</a> (1)</li>

    
    <li><a href="../archive/2012/5/index.html"
        >May</a> (1)</li>

    
    <li><a href="../archive/2012/4/index.html"
        >April</a> (2)</li>

    
    <li><a href="../archive/2012/3/index.html"
        >March</a> (1)</li>

    
    <li><a href="../archive/2012/1/index.html"
        >January</a> (1)</li>

    
        </ul>
        <h6>2011</h6><ul class="unstyled">
    
    <li><a href="../archive/2011/12/index.html"
        >December</a> (4)</li>

    
    <li><a href="../archive/2011/11/index.html"
        >November</a> (1)</li>

    
    <li><a href="../archive/2011/10/index.html"
        >October</a> (2)</li>

    
    <li><a href="../archive/2011/9/index.html"
        >September</a> (2)</li>

    
    <li><a href="../archive/2011/8/index.html"
        >August</a> (1)</li>

    
    <li><a href="../archive/2011/7/index.html"
        >July</a> (2)</li>

    
    <li><a href="../archive/2011/6/index.html"
        >June</a> (5)</li>

    
    <li><a href="../archive/2011/5/index.html"
        >May</a> (1)</li>

</ul>






<h3>Categories</h3>
<ul class="unstyled">

<li><a href="../category/announcements"
    >Announcements</a> (3)</li>

<li><a href="../category/blog-post/index.html"
    >Blog Post</a> (69)</li>

</ul>











<h3>Authors</h3>
<ul class="unstyled">

    <li><a href="../author/devbisme/index.html"
        >Dave Vandenbout</a>
        (72)</li>

</ul>




<h3>Feeds</h3>




    <a href="../feeds/rss/index.html">RSS</a> /
    <a href="../feeds/atom/index.html">Atom</a>




    </div>
</div>

</div>
</div>

<footer>
<div class="container">
<!-- 

<ul class="clearfix"><li><ul><li 
            id="footer-menu-learn"><a href="/learn/">Learn</a></li><li 
            id="footer-menu---2"><a href="/-2">***menu-divider***</a></li></ul></li><li><ul><li 
            id="footer-menu-store"><a href="/store/">Buy</a></li><li 
            id="footer-menu-store-fpga-boards"><a href="/store/fpga-boards/">FPGA Boards</a></li><li 
            id="footer-menu-store-add-on-boards"><a href="/store/add-on-boards/">Add-On Boards</a></li><li 
            id="footer-menu-store-miscellaneous"><a href="/store/miscellaneous/">Miscellaneous</a></li><li 
            id="footer-menu--"><a href="/">***menu-divider***</a></li><li 
            id="footer-menu-store-distributors"><a href="/store/distributors/">Distributors</a></li><li 
            id="footer-menu-store-purchasing-policies"><a href="/store/purchasing-policies/">Sales Policies</a></li><li 
            id="footer-menu-store-discontinued"><a href="/store/discontinued/">Discontinued Products</a></li></ul></li><li><ul><li 
            id="footer-menu-interact"><a href="/interact/">Interact</a></li><li 
            id="footer-menu---3"><a href="/-3">***menu-divider***</a></li><li 
            id="footer-menu--blog-category-announcements"><a href="/blog/category/announcements">Announcements</a></li><li 
            id="footer-menu--blog-"><a href="/blog/">Blog</a></li><li 
            id="footer-menu-interact-rss-feeds"><a href="/interact/rss-feeds/">RSS Feeds</a></li><li 
            id="footer-menu---1"><a href="/-1">***menu-divider***</a></li><li 
            id="footer-menu-interact-contact"><a href="/interact/contact/">Contact</a></li><li 
            id="footer-menu--organizations-xess-"><a href="/organizations/xess/">About</a></li></ul></li></ul>
 -->
<p>
    <a href="mailto:webmaster@xess.com">webmaster@xess.com</a>
    <span class="separator">|</span>
    &copy; 2013 by XESS Corp. All rights reserved.
    
</p>
</div>
</footer>








<script>

var _gaq = _gaq || [['_trackPageview']];
_gaq.unshift(['_setAccount', 'UA-765812-5']);
(function(d, t) {
    var g = d.createElement(t),
        s = d.getElementsByTagName(t)[0];
    g.async = true;
    g.src = '//www.google-analytics.com/ga.js';
    s.parentNode.insertBefore(g, s);
})(document, 'script');


// This is for rendering digital waveforms.
(function(){ window.addEventListener("load", WaveDrom.ProcessAll, false); })();

// This is for drop-down menus.
$('ul.nav li.dropdown').hover(function() {
    $(this).closest('.dropdown-menu').stop(true, true).show();
    $(this).addClass('open'); 
} , function() { 
    $(this).closest('.dropdown-menu').stop(true, true).hide(); 
    $(this).removeClass('open'); 
});
</script>


</body>
</html>
